trigger:
  - main

jobs:
  - job: Build
    displayName: 'Build job'
    pool:
      vmImage: 'windows-latest'
    steps:
      - checkout: self
      - task: NodeTool@0
        inputs:
          versionSpec: '14.x'
        displayName: 'Install Node.js'
      - script: |
          npm install
          npm run build
        displayName: 'Install and Build Node.js App'
      - task: PublishBuildArtifacts@1
        inputs:
          pathtoPublish: '$(System.DefaultWorkingDirectory)'  # Update with your actual path
          artifactName: 'drop'
          publishLocation: 'Container'

  - job: Deploy
    displayName: 'Deploy job'
    dependsOn: Build
    pool:
      vmImage: 'windows-latest'
    steps:
      - checkout: self
      - task: DownloadBuildArtifacts@0
        inputs:
          buildType: 'current'
          downloadType: 'single'
          artifactName: 'drop'
          downloadPath: '$(System.DefaultWorkingDirectory)/artifacts'
      - task: IISWebAppManagementOnMachineGroup@0
        inputs:
          IISDeploymentType: 'IISWebsite'
          ActionIISWebsite: 'CreateOrUpdateWebsite'
          WebsiteName: 'IoTTesting'
          PhysicalPath: 'C:\IoTUI'  # Update with your actual path
          CreateOrUpdateAppPool: true
          AppPoolName: 'IoTTesting_Pool'
          DotNetVersion: 'v5.0'
          ServerName: '98.70.42.23'  # Add your server name or IP address
          AuthenticationType: 'Basic'  # Choose the appropriate authentication type
          Username: 'IBuser'  # Add your server username
          Password: 'IBtesting#321'  # Add your server password
